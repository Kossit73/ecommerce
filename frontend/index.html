<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ecommerce Financial Model Console</title>
    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script defer src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
    <script defer type="module" src="assets/js/app.js"></script>
  </head>
  <body>
    <header class="app-header">
      <div class="branding">
        <h1>Ecommerce Financial Model</h1>
        <p class="tagline">Model assumptions, scenarios, analytics, and reporting from a single console.</p>
      </div>
    </header>

    <main>
      <div class="tab-bar" role="tablist" aria-label="Section navigation">
        <button class="nav-link active" data-target="input-section">Input &amp; Assumptions</button>
        <button class="nav-link" data-target="metrics-section">Key Financial Metrics</button>
        <button class="nav-link" data-target="performance-section">Financial Performance</button>
        <button class="nav-link" data-target="position-section">Financial Position</button>
        <button class="nav-link" data-target="cashflow-section">Cash Flow Statement</button>
        <button class="nav-link" data-target="sensitivity-section">Sensitivity Analysis</button>
        <button class="nav-link" data-target="advanced-section">Advanced Analysis</button>
      </div>

      <section class="content">
        <article id="input-section" class="panel active" aria-label="Input and assumptions">
          <header>
            <h2>Input &amp; Assumptions</h2>
            <p>Manage Excel assumptions, edit yearly tables, and trigger preprocessing workflows.</p>
          </header>

          <section class="card" aria-labelledby="file-controls-title">
            <div class="card-header">
              <h3 id="file-controls-title">Workbook actions</h3>
              <div class="card-actions">
                <button id="refresh-file" class="secondary">Load existing</button>
                <button id="start-new" class="secondary">Start new workbook</button>
              </div>
            </div>
            <div class="card-body file-uploader">
              <form id="upload-form">
                <label for="assumption-file" class="form-label">Upload assumptions workbook</label>
                <input id="assumption-file" name="file" type="file" accept=".xlsx" />
                <button type="submit" class="primary">Upload &amp; load</button>
              </form>
              <p id="file-status" class="status"></p>
            </div>
          </section>

          <section class="card" aria-labelledby="assumptions-table-title">
            <div class="card-header">
              <h3 id="assumptions-table-title">Assumption tables</h3>
              <div class="card-actions">
                <button id="add-assumption-row" class="secondary">Add year</button>
                <button id="reset-assumptions" class="secondary">Reset edits</button>
                <button id="save-assumptions" class="primary">Save to Excel</button>
              </div>
            </div>
            <div class="card-body">
              <p class="card-intro">
                Update the underlying demand, cost, staffing, and financing assumptions for each forecast year. Edits are applied live across the tables below before exporting back to Excel.
              </p>
              <div class="assumption-groups" id="assumption-groups" aria-live="polite"></div>
            </div>
          </section>

          <section class="card" aria-labelledby="filter-title">
            <div class="card-header">
              <h3 id="filter-title">Filter &amp; base analysis</h3>
            </div>
            <div class="card-grid">
              <form id="filter-form" class="stack">
                <h4>Filter time period</h4>
                <label>Start year<input type="number" name="start_year" /></label>
                <label>End year<input type="number" name="end_year" /></label>
                <button type="submit" class="secondary">Apply filter</button>
              </form>

              <form id="base-analysis-form" class="stack">
                <h4>Run base analysis</h4>
                <div class="two-column">
                  <label>Discount rate<input type="number" step="0.01" name="discount_rate" value="0.2" /></label>
                  <label>WACC<input type="number" step="0.01" name="wacc" value="0.1" /></label>
                  <label>Perpetual growth<input type="number" step="0.01" name="perpetual_growth" value="0.02" /></label>
                  <label>Tax rate<input type="number" step="0.01" name="tax_rate" value="0" /></label>
                  <label>Inflation rate<input type="number" step="0.01" name="inflation_rate" value="0" /></label>
                  <label>Labor increase<input type="number" step="0.01" name="direct_labor_rate_increase" value="0" /></label>
                  <label>Forecast years<input type="number" name="normal_forecast_years" value="10" /></label>
                </div>
                <button type="submit" class="primary">Run analysis</button>
              </form>
            </div>
            <div class="card-body">
              <pre id="base-analysis-result" class="code"></pre>
            </div>
          </section>
        </article>

        <article id="metrics-section" class="panel" aria-label="Key financial metrics">
          <header>
            <h2>Key financial metrics</h2>
            <p>Summaries, valuation results, and KPI dashboards based on the current filtered scenario.</p>
          </header>
          <section class="card">
            <div class="card-header">
              <h3>Headline metrics</h3>
              <button id="refresh-key-metrics" class="secondary">Refresh metrics</button>
            </div>
            <div class="card-body" id="key-metrics-container"></div>
          </section>

          <section class="card">
            <div class="card-header">
              <h3>Operational metrics</h3>
            </div>
            <div class="card-body" id="operational-metrics-container"></div>
          </section>

          <section class="card">
            <div class="card-header">
              <h3>DCF valuation snapshot</h3>
            </div>
            <div class="card-body" id="valuation-container"></div>
          </section>

          <section class="card">
            <div class="card-header">
              <h3>Scenario comparison</h3>
            </div>
            <div class="card-body" id="scenario-metrics-container"></div>
          </section>

          <section class="card">
            <div class="card-header">
              <h3>Scenario management</h3>
              <div class="card-actions">
                <button type="button" id="scenario-load-defaults" class="secondary">Reset to defaults</button>
              </div>
            </div>
            <div class="card-body">
              <form id="scenario-form" class="stack">
                <label>Scenario type
                  <select name="scenario_type" id="scenario-type">
                    <option value="Base Case">Base Case</option>
                    <option value="Best Case">Best Case</option>
                    <option value="Worst Case">Worst Case</option>
                  </select>
                </label>
                <div class="scenario-grid" id="scenario-params" aria-live="polite"></div>
                <div class="two-column">
                  <label>Discount rate
                    <input type="number" step="0.01" name="discount_rate" value="0.2" required />
                  </label>
                  <label>Tax rate
                    <input type="number" step="0.01" name="tax_rate" value="0" required />
                  </label>
                  <label>Inflation rate
                    <input type="number" step="0.01" name="inflation_rate" value="0" required />
                  </label>
                  <label>Labor increase
                    <input type="number" step="0.01" name="direct_labor_rate_increase" value="0" required />
                  </label>
                </div>
                <button type="submit" class="primary">Recompute scenario</button>
              </form>
              <div id="scenario-result" class="scenario-result"></div>
            </div>
          </section>

          <section class="card">
            <div class="card-header">
              <h3>Narrative implications</h3>
              <button id="refresh-implications" class="secondary">Refresh</button>
            </div>
            <div class="card-body" id="implications-container">
              <p class="status">Sign in and refresh to load qualitative implications.</p>
            </div>
          </section>

          <section class="card">
            <div class="card-header">
              <h3>Revenue &amp; profitability charts</h3>
              <div class="card-actions">
                <button id="refresh-charts" class="secondary">Refresh charts</button>
              </div>
            </div>
            <div class="chart-grid">
              <div id="revenue-chart" class="chart"></div>
              <div id="traffic-chart" class="chart"></div>
              <div id="profitability-chart" class="chart"></div>
              <div id="cashflow-forecast-chart" class="chart"></div>
            </div>
          </section>
        </article>

        <article id="performance-section" class="panel" aria-label="Financial performance">
          <header>
            <h2>Financial performance</h2>
            <p>Review income statement, KPI waterfalls, and customer metrics for the active timeframe.</p>
          </header>
          <section class="card">
            <div class="card-header"><h3>Income statement</h3></div>
            <div class="card-body" id="income-statement-container"></div>
          </section>
          <section class="card">
            <div class="card-header"><h3>Customer metrics</h3></div>
            <div class="card-body" id="customer-metrics-container"></div>
          </section>
          <section class="card">
            <div class="card-header">
              <h3>Performance charts</h3>
              <div class="card-actions">
                <button id="refresh-performance-charts" class="secondary">Refresh charts</button>
              </div>
            </div>
            <div class="chart-grid">
              <div id="waterfall-chart" class="chart"></div>
              <div id="breakeven-chart" class="chart"></div>
              <div id="consideration-chart" class="chart"></div>
              <div id="margin-safety-chart" class="chart"></div>
              <div id="margin-trends-chart" class="chart"></div>
            </div>
          </section>
        </article>

        <article id="position-section" class="panel" aria-label="Financial position">
          <header>
            <h2>Financial position</h2>
            <p>Balance sheet and capital asset schedules derived from the latest base analysis.</p>
          </header>
          <section class="card">
            <div class="card-header"><h3>Balance sheet</h3></div>
            <div class="card-body" id="balance-sheet-container"></div>
          </section>
          <section class="card">
            <div class="card-header"><h3>Capital assets</h3></div>
            <div class="card-body" id="capital-assets-container"></div>
          </section>
        </article>

        <article id="cashflow-section" class="panel" aria-label="Cash flow statement">
          <header>
            <h2>Cash flow statement</h2>
            <p>Detailed cash flow schedule including operating, investing, and financing activities.</p>
          </header>
          <section class="card">
            <div class="card-header"><h3>Cash flow schedule</h3></div>
            <div class="card-body" id="cashflow-container"></div>
          </section>
          <section class="card">
            <div class="card-header"><h3>Debt amortization</h3></div>
            <div class="card-body" id="debt-schedule-container"></div>
          </section>
          <section class="card">
            <div class="card-header">
              <h3>Cash flow visuals</h3>
              <div class="card-actions">
                <button id="refresh-cashflow-charts" class="secondary">Refresh charts</button>
              </div>
            </div>
            <div class="chart-grid">
              <div id="cashflow-forecast-detailed" class="chart"></div>
              <div id="dcf-summary-chart" class="chart"></div>
            </div>
          </section>
        </article>

        <article id="sensitivity-section" class="panel" aria-label="Sensitivity analysis">
          <header>
            <h2>Sensitivity analysis</h2>
            <p>Stress-test core drivers and explore directional impacts on profitability and value.</p>
          </header>
          <section class="card">
            <div class="card-header">
              <h3>Top-rank sensitivity</h3>
            </div>
            <form id="top-rank-form" class="card-body stack">
              <label>Variables to test (comma separated)
                <input type="text" name="variables" placeholder="Average Item Value,COGS Percentage" required />
              </label>
              <label>Change percentage
                <input type="number" name="change_percentage" value="5" step="0.1" required />
              </label>
              <label>Discount rate
                <input type="number" name="discount_rate" value="0.2" step="0.01" required />
              </label>
              <button type="submit" class="primary">Run sensitivity</button>
            </form>
            <div class="card-body" id="top-rank-results"></div>
          </section>

          <section class="card">
            <div class="card-header"><h3>What-if analysis</h3></div>
            <form id="what-if-form" class="card-body stack">
              <label>Variable name
                <input type="text" name="variable" placeholder="Average Item Value" required />
              </label>
              <label>Target year
                <input type="number" name="year" value="2025" required />
              </label>
              <label>Multiplier
                <input type="number" step="0.1" name="multiplier" value="1.1" required />
              </label>
              <button type="submit" class="secondary">Apply what-if</button>
            </form>
            <div class="card-body" id="what-if-results"></div>
          </section>

          <section class="card">
            <div class="card-header"><h3>Goal seek</h3></div>
            <form id="goal-seek-form" class="card-body stack">
              <label>Target metric
                <select name="metric">
                  <option value="Net Income">Net Income</option>
                  <option value="EBITDA">EBITDA</option>
                  <option value="Net Cash Flow">Net Cash Flow</option>
                </select>
              </label>
              <label>Target year<input type="number" name="year" value="2025" required /></label>
              <label>Target value<input type="number" name="target" value="500000" step="1000" required /></label>
              <label>Driver to adjust<input type="text" name="driver" value="Average Item Value" required /></label>
              <button type="submit" class="secondary">Run goal seek</button>
            </form>
            <div class="card-body" id="goal-seek-results"></div>
          </section>
        </article>

        <article id="advanced-section" class="panel" aria-label="Advanced analytics">
          <header>
            <h2>Advanced analysis</h2>
            <p>Access Monte Carlo simulations, forecasting, schedule risk, neural tools, and optimization utilities.</p>
          </header>

          <section class="card">
            <div class="card-header"><h3>Reporting &amp; exports</h3></div>
            <div class="card-body stack">
              <p class="status">Download the consolidated Excel workbook with the latest filtered scenario.</p>
              <button id="download-report" type="button" class="secondary">Download Excel report</button>
              <p id="download-status" class="status" aria-live="polite"></p>
            </div>
          </section>

          <section class="card">
            <div class="card-header"><h3>Monte Carlo simulation</h3></div>
            <form id="monte-carlo-form" class="card-body stack">
              <label>Iterations<input type="number" name="iterations" value="500" /></label>
              <label>Forecast years<input type="number" name="forecast_years" value="5" /></label>
              <label>Discount rate<input type="number" step="0.01" name="discount_rate" value="0.2" /></label>
              <label>Volatility<input type="number" step="0.01" name="volatility" value="0.1" /></label>
              <button type="submit" class="secondary">Run simulation</button>
            </form>
            <div class="card-body" id="monte-carlo-results"></div>
          </section>

          <section class="card">
            <div class="card-header"><h3>Schedule risk analysis</h3></div>
            <form id="schedule-risk-form" class="card-body stack">
              <label>Confidence level<input type="number" name="confidence_level" value="0.9" step="0.01" /></label>
              <textarea name="tasks" rows="4" placeholder='[{"name":"Launch","base_duration":10,"std_dev":2}]'></textarea>
              <button type="submit" class="secondary">Run schedule risk</button>
            </form>
            <div class="card-body" id="schedule-risk-results"></div>
          </section>

          <section class="card">
            <div class="card-header"><h3>Neural tools forecast</h3></div>
            <form id="neural-tools-form" class="card-body stack">
              <label>Traffic increase %<input type="number" name="traffic_increase_percentage" value="5" step="0.1" /></label>
              <button type="submit" class="secondary">Predict revenue</button>
            </form>
            <div class="card-body" id="neural-tools-results"></div>
          </section>

          <section class="card">
            <div class="card-header"><h3>Precision tree</h3></div>
            <div class="card-body stack">
              <button id="precision-tree-btn" class="secondary">Load decision analysis</button>
              <div id="precision-tree-results"></div>
            </div>
          </section>

          <section class="card">
            <div class="card-header"><h3>Statistical forecasting</h3></div>
            <form id="stat-forecast-form" class="card-body stack">
              <label>Forecast years<input type="number" name="forecast_years" value="5" /></label>
              <label>Confidence level<input type="number" name="confidence_level" value="0.9" step="0.01" /></label>
              <button type="submit" class="secondary">Generate forecast</button>
            </form>
            <div class="card-body" id="stat-forecast-results"></div>
          </section>

          <section class="card">
            <div class="card-header"><h3>Evolver optimization</h3></div>
            <form id="evolver-form" class="card-body stack">
              <label>Budget line<input type="text" name="budget_line" placeholder="Total Marketing Budget" required /></label>
              <label>Budget amount<input type="number" name="budget_amount" value="100000" step="1000" required /></label>
              <label>Forecast years<input type="number" name="forecast_years" value="5" /></label>
              <button type="submit" class="secondary">Optimize</button>
            </form>
            <div class="card-body" id="evolver-results"></div>
          </section>
        </article>
      </section>
    </main>

    <aside id="toast" role="status" aria-live="assertive"></aside>
  </body>
</html>
